<html>
<head>
	<title>Android Malware Research</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<ul class="topnav">
		<li><a class="active" href="index.html">Home</a></li>
		<li><a href="#summary">Summary</a></li>
		<li><a href="#root">Root</a></li>
		<li><a href="#firewall">Firewall</a></li>
		<li><a href="#uninstall">Uninstalling Malware</a></li>
		<li><a href="#av">Anti-Malware</a></li>
		<li><a href="#connection">Connections</a></li>
		<li><a href="#malware">Malware Samples</a></li>
		<li><a href="umi-diamond.html">Misc/Other</a></li>
		<!-- <li class="right"><a href="misc.html">Misc/Other</a></li> -->
	</ul>

	<div style="padding:0 16px;" id="summary">
		<h1>Summary of Research Device - UMI Diamond</h1>

		<p>Here are some important notes when reading this page:</p>
		<ul>
			<li>This is a work in progress.</li>
			<li>Most of the screenshots are while attempting to clean malware from the phone, rather than a safe environment, meaning I couldn't get all the important data.</li>
			<li>I will flash the original malware ridden ROM on one of these devices for further reasearch.</li>
		</ul>

		<p>Android is an operating system that has a niche in portable devices, namely phones. If you're like me and love a good deal, the selection of Chinese branded phones are certainly something that'll catch your eye. I bought a device called an "UMI Diamond" in December 2016. This device was appealing because it had the following features:</p>
		<ul>
			<li>3GB of RAM</li>
			<li>720p recording of video</li>
			<li>Removable Battery</li>
			<li>Dual SIM Card and 1 SDcard</li>
			<li>Nice 720p screen</li>
			<li>$100 price</li>
			<li>Works on AT&amp;T 3G and T-Mobile 2G</li>
			<li>Android 6.0 Marshmallow</li>
		</ul>

		<p>Like many Chinese phone devices, this one had a little bit more than was expected, namely malware. The first experience I had with this was with some screen locking application that didn't allow the user to use their phone. I had to flash new firmware for that one. On top of that, I saw many popups from XPrivacy, which I could never figure out how to set to automatically block instead of allow. Whatever got on this thing was trying to take it over. I made sure at that point to flash the original image. It didn't occur to me that it had a backdoor of any type. I just figured that it was a security flaw in Android 6 itself, and that there was nothing I could do in that respect. Eventually there were other malware where ads injected themselves into Google Chrome and on the desktop an Orb would appear that showed ads. Later, I noticed that the phone would turn the WiFi back on after I turned it off.</p>

		<p>After that point, I decided to see how to uninstall applications that are system apps. I did find some page on StackOverflow that explained how to do it with the ADB shell, but I've not found that since.</p>

		<p>I have found that the following tools and techniques have been useful in securing the UMI Diamond device. I have made a page for each one detailing what it is and why it's a useful security mechanism. If there is a tool(s) I found I preferred, I will list it. I am not paid or associated with an app makers.</p>
	</div>

	<div style="padding:0 16px;" id="root">
		<h1>Rooting the UMI Diamond Device</h1>

		<p>This device is rootable. In fact, as odd as this may seem, this device provider gives the original firmware for every FOTA update, and even provides community made TWRP and CWM images for SPFlashtool. In fact, if you're one of the people who has concerns about Adups FOTA software on your phone, you can re-flash the image manually, and then root and remove the Adups FOTA software.</p>

		<a href="http://community.umidigi.com/forum-125-1.html">UMIDIGI ROM Page</a>
		<a href="http://community.umidigi.com/thread-2962-1-1.html">UMIDIGI Custom Recovery Page</a>

		<p>Despite the fact that rooting a phone is considerd a security risk, I have found it to be a necessity when securing a phone, as you need full control of it to remove deep malware, not to mention the fact malware itself may come with its own exploit causing it to be able to get root access. The concept of rooting is a side effect of a bad permissions system in Android. There's always going to be bugs, no matter how good you make software, you're always going to need low level access potentially to repair things within the operating system. Microsoft Windows has a system where you have an administrator account. Desktop distributions of Linux have root access that is secured by password. Why does Android, which also uses the Linux kernel lack such a simple feature? After following UMIDIGI's tutorials on rooting the device I was able to begin purifying the device.<p>

		<p>In summary, for this device to be secure, it is necessary to have root access to use a VPN-free firewall, remove malware, and install XPrivacy.</p>
	</div>

	<div style="padding:0 16px;" id="uninstall">
		<h1>Removing Software for Security</h1>

		<p>There are three main tools I used for removing software:</p>
		<ul>
			<li><a href="https://play.google.com/store/apps/details?id=com.jumobile.manager.systemapp">System App Remover</a></li>
			<li><a href="https://play.google.com/store/apps/details?id=com.keramidas.TitaniumBackup">Titanium Backup</a></li>
			<li><a href="https://play.google.com/store/apps/details?id=com.ghisler.android.TotalCommander">Total Commander</a></li>
		</ul>

		<p>The "System App Remover" and "Titanium Backup" are great apps for removing system apps that can't usually be removed. This requires root and it can remove simple bloatware or embedded malware. Two notable apps on the UMI Diamond phone are "com.android.telephone", a fake app to look like a real telephone app, one called "LovelyFont" which attached itself to the Google Play Store and couldn't be removed. Very odd malware, still on the store for some reason. These two apps were able to remove those with root. I do like the fact that System App Remover tells the package name clearly so you do not accidently remove the wrong app. Here we can see a screenshot of malware dropping a fake system settings app, along with other payloads.</p>

		<a href="android-malware-img/Screenshot_20171113-053352.png">
			<figure>
				<img src="android-malware-img/Screenshot_20171113-053352.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>Here is another example. Notice both have the use system icon to attempt to fool the user into thinking it's the real settings app.</p>
		<a href="android-malware-img/Screenshot_20170901-145309.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170901-145309.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>Total Commander is another great tool. If there's a file within the system that needs to worked with that isn't a standard app, this can manipulate system files with a rooted phone. Here is an example where I copied system files to a SDCard since AV scanners don't seem to reach the system files where malware hides. Here is a sample where Kaspersky for Android sees files on a SDCard that weren't seen in the system folder.</p>
		<a href="android-malware-img/Screenshot_20170623-145536.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170623-145536.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>Here is a screenshot of a standard Kaspersky scan at the time. Since then, Kaspersky will unzip the APK package and look inside to find malware hiding. This older screenshot does not see the malware inside the SystemUI package.</p>
		<a href="android-malware-img/232507clo1j5nqjfomef4z.png">
			<figure>
				<img src="android-malware-img/232507clo1j5nqjfomef4z.png" height="400"></img>
				<figcaption>
					<i>Click for larger image. Credit to bencebacsi from UMIDIGI Forums.</i>
				</figcaption>
			</figure>
		</a>
	</div>

	<div style="padding:0 16px;" id="firewall">
		<h1>Using a Firewall to Secure an Android Device</h1>
		<p>Firewalls can block malware to a limited degree. This can be used to find what apps are dropping malware into the machine. Blocking an app that is doing a lot of traffic can be used to see if it's dropping. There is an issue with AFWall+, as the iptables Android has tends to lack in the realm of ipv6. I've had times where my phone is receiving email and data messages when the firewall is blocking apps.</p>
		<p>Here we can see that the SystemUI application is not allowed to contact the internet, yet is still able to drop malware.</p>
		<a href="android-malware-img/Screenshot_20170901-145309.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170901-145309.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>
	</div>

	<div style="padding:0 16px;" id="av">
		<h1>Anti-Malware for an Android Device.</h1>
		<p>There are four main Anti-Malware programs for Android that I prefer.</p>

		<ul>
			<li>Kaspersky</li>
			<li>Malwarebytes</li>
			<li>360 Security</li>
			<li>Google Play Protect</li>
		</ul>

		<h2>Kaspersky</h2>
		<h2>Malwarebytes</h2>
		<h2>360 Security</h2>
		<p>360 Security is an anti-malware program with other features such as a disk cleaner, firewall, among other things. Admittedly, some of these things are invasive and are likely designed to show the user more ads, but overall, as long as you uncheck a lot of settings, the program has a lot of neat positives like free real time protect, web protection, and can even make use of root for a deeper scan.</p>
		<p>A few interesting screenshots:</p>
		<a href="android-malware-img/Screenshot_20180102-152428.png">
			<figure>
				<img src="android-malware-img/Screenshot_20180102-152428.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<h2>Google Play Protect</h2>
		<p>Google Play Protect is an anti-malware utility built into the Google Play store. Here is a screenshot of it blocking the installation of a dropped malware app.</p>
		<a href="android-malware-img/Screenshot_20180103-142526.png">
			<figure>
				<img src="android-malware-img/Screenshot_20180103-142526.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>It's possible to let this get through by disabling Play Protect if needed.</p>
	</div>

	<div style="padding:0 16px;" id="connection">
		<h1>View Connections on Android</h1>
		<p>Having a program to view what apps are actively sending and receiving data are important to seeing what programs are transferring malicious payloads or perhaps sendout out personal information without the user's consent. More will be expanded here when I go and bring in some malware into a test environment.</p>
	</div>

	<div style="padding:0 16px;" id="xprivacy">
		<h1>XPrivacy</h1>
		<p>XPrivacy allows fine-grain control of individual permissions. It brings up dialogs for the users. Here is a sample of a dropped piece of malware called "GStore" that XPrivacy brought to my attention. As you can tell by the unusual URL it accessed, it is likely a malicious app.</p>
		<a href="android-malware-img/Screenshot_20170821-103019.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170821-103019.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>
		<a href="android-malware-img/Screenshot_20170817-082608.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170817-082608.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>You can choose to deny individual subpermissions, and this allows auditing deeper of what is actually going on with the app.</p>
		<a href="android-malware-img/Screenshot_20170713-201252.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170713-201252.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>
		<a href="android-malware-img/Screenshot_20170713-201223.png">
			<figure>
				<img src="android-malware-img/Screenshot_20170713-201223.png" height="400"></img>
				<figcaption>
					<i>Click for larger image.</i>
				</figcaption>
			</figure>
		</a>

		<p>The XPrivacy application requires root and the Xposed Framework installed on the Android device.</p>
	</div>
	<div style="padding:0 16px;" id="malware">
		<h1>Malware Samples</h1>
		<p>For quite a while, the malwares on this weren't detected by the AV systems. Why is beyond me, but hopefully some of the found stuff can be added to their lists when I find a good way to host it.</p>
	</div>
</body>
</html>
